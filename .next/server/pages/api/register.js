"use strict";(()=>{var e={};e.id=553,e.ids=[553],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1329:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>g,routeModule:()=>p});var s={};t.r(s),t.d(s,{default:()=>c});var a=t(1802),i=t(7153),n=t(6249),o=t(9344),u=t.n(o),l=t(4802),d=t(2250);let m=process.env.JWT_SECRET||"dev_secret_key";async function c(e,r){if("POST"!==e.method)return r.status(405).json({message:"Method not allowed"});let{email:t,password:s,name:a}=e.body;if(!t||!s)return r.status(400).json({message:"Email and password required"});try{if(console.log("Registering user with email:",t),await d.Z.user.findUnique({where:{email:t}}))return r.status(409).json({message:"User already exists with this email"});let e=await d.Z.user.create({data:{email:t,name:s}}),a=u().sign({userId:e.id,email:e.email},m,{expiresIn:"1h"});return r.setHeader("Set-Cookie",(0,l.serialize)("token",a,{httpOnly:!0,secure:!0,maxAge:3600,sameSite:"strict",path:"/"})),r.status(201).json({token:a})}catch(t){console.error("Registration error:",t);let e={};if(t instanceof Error){if("PrismaClientInitializationError"===t.name)return r.status(500).json({message:"Database connection error. Please try again later.",error:t.message});if("P2002"===t.code&&t.meta?.target?.includes("email"))return r.status(409).json({message:"User already exists with this email",error:t.message});e={name:t.name,message:t.message,stack:void 0}}else e={name:typeof t,message:JSON.stringify(t)};return r.status(500).json({message:"Registration failed",error:e})}}let g=(0,n.l)(s,"default"),f=(0,n.l)(s,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/register",pathname:"/api/register",bundlePath:"",filename:""},userland:s})},2250:(e,r,t)=>{t.d(r,{Z:()=>a});var s=t(3524);let a=global.prisma||new s.PrismaClient({log:["error"]})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1329);module.exports=t})();